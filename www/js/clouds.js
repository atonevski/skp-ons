// Generated by CoffeeScript 2.3.2

// clouds.coffee: map with clouds

var map, renderClouds;

window.fn.loadClouds = function() {
  var content, menu;
  content = $('#content')[0];
  menu = $('#menu')[0];
  return content.load('views/clouds.html').then(menu.close.bind(menu)).then(renderClouds);
};

map = null;

renderClouds = function() {
  var APPID, baseMaps, city, clouds, layerControl, osm, overlayMaps;
  $('ons-page#clouds-page')[0].addEventListener('destroy', function() {
    console.log('destroying clouds page...');
    if (map != null) {
      map.remove();
      return map = null;
    }
  });
  $('ons-page#clouds-page')[0].addEventListener('init', function() {
    return console.log('init clouds...');
  });
  $('ons-page#clouds-page')[0].addEventListener('hide', function() {
    return console.log('hide clouds...');
  });
  // OWM api id
  APPID = '74caac32fcc2d61b715c249e789a875e';
  osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 18,
    attribution: 'some attribution'
  });
  // id: 'mapbox.streets'
  map = L.map("map-id", {
    center: new L.LatLng(42, 21.43),
    zoom: 6,
    layers: [osm]
  });
  
  // osm.addTo $scope.map
  clouds = L.OWM.clouds({
    showLegend: false,
    opacity: 0.65,
    appId: APPID
  });
  city = L.OWM.current({
    intervall: 15,
    lang: 'mk'
  });
  baseMaps = {
    "OSM Standard": osm
  };
  overlayMaps = {
    "Clouds": clouds,
    "Cities": city
  };
  layerControl = L.control.layers(baseMaps, overlayMaps).addTo(map);
  return map.on('locationerror', function(e) {
    return console.log("Leaflet loc err: ", e);
  });
};
